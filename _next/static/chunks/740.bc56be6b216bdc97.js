"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[740],{1740:(e,r,t)=>{t.r(r),t.d(r,{default:()=>i});var n=t(5155),c=t(2115),o=t(4656);let a=(e,r,t)=>Math.min(t,Math.max(r,e)),u=e=>e>180?e-360:e<-180?e+360:e,l=(e,r)=>{let t=r-e;return t>180&&(t-=360),t<-180&&(t+=360),t},s=e=>{let[r,t]=e;return t>=44&&t<=56&&r>=5&&r<=33};function i(e){let{stage:r,allStages:t}=e,i="whats-next"===r.id,[m,d]=(0,c.useState)(!1),h=(0,c.useRef)(i),f=(0,c.useRef)(!1),g=(0,c.useRef)(0);(0,c.useEffect)(()=>{let e=window.matchMedia("(min-width: 1100px)"),r=()=>d(e.matches);return r(),e.addEventListener("change",r),()=>e.removeEventListener("change",r)},[]),(0,c.useEffect)(()=>{h.current=i,i?(f.current=!1,g.current=R.current.center[0]):f.current=!1},[i]);let M=(0,c.useMemo)(()=>t.map(e=>[e.lng,e.lat]),[t]),p=(0,c.useMemo)(()=>t.findIndex(e=>e.id===r.id),[t,r.id]),w="Vancouver"===r.city?.9:"Hong Kong SAR"===r.country?1.15:"Canada"===r.country?.45:0,z=m&&"Canada"===r.country&&!i?.9:0,b=i?1.05:a(r.zoom-4-w-z,1.8,4),x=m&&!i?"Vancouver"===r.city?14:"Canada"===r.country?-12:0:0,k=(0,c.useMemo)(()=>[r.lng,r.lat],[r.lng,r.lat]),y=(0,c.useMemo)(()=>i?[0,15]:[r.lng+x,r.lat],[x,i,r.lng,r.lat]),[j,v]=(0,c.useState)({center:y,zoom:b}),R=(0,c.useRef)(j),E=(0,c.useRef)({center:y,zoom:b}),N=(0,c.useRef)({lng:0,lat:0,zoom:0}),C=(0,c.useRef)(0),W=(0,c.useRef)(0),A=(0,c.useRef)(!1),F=(0,c.useRef)(null),G=(0,c.useRef)(y);return(0,c.useEffect)(()=>{R.current=j},[j]),(0,c.useEffect)(()=>{if(A.current)return;A.current=!0,W.current=0;let e=r=>{let t=W.current||r,n=a((r-t)/1e3,.001,.05);if(W.current=r,h.current&&f.current){g.current=u(g.current+8.5*n);let r={center:[g.current,15],zoom:1.05};v(r),R.current=r,C.current=window.requestAnimationFrame(e);return}let c=R.current,o=E.current,s=N.current,i=l(c.center[0],o.center[0]),m=o.center[1]-c.center[1],d=o.zoom-c.zoom,M=a(23+3.2*Math.max(.8*Math.abs(i),Math.abs(m),10*Math.abs(d)),23,42),p=Math.exp(-10.8*n),w=a(.07+.9*n,.07,.13);s.lng=(s.lng+i*M*n)*p,s.lat=(s.lat+m*M*n)*p,s.zoom=(s.zoom+d*M*n)*p;let z={center:[u(c.center[0]+i*w+s.lng*n),c.center[1]+m*w+s.lat*n],zoom:a(c.zoom+d*w+s.zoom*n,1,12)},b=.02>Math.abs(i)&&.02>Math.abs(m),x=.01>Math.abs(d),k=.03>Math.abs(s.lng)&&.03>Math.abs(s.lat)&&.03>Math.abs(s.zoom);h.current&&b&&x&&k&&(f.current=!0,g.current=o.center[0]),b&&x&&k?(N.current={lng:0,lat:0,zoom:0},v(o),R.current=o):(v(z),R.current=z),C.current=window.requestAnimationFrame(e)};return C.current=window.requestAnimationFrame(e),()=>{null!==F.current&&window.clearTimeout(F.current),C.current&&window.cancelAnimationFrame(C.current),A.current=!1}},[]),(0,c.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(null!==F.current&&(window.clearTimeout(F.current),F.current=null),e){let e={center:y,zoom:b};E.current=e,N.current={lng:0,lat:0,zoom:0},v(e),R.current=e,f.current=i;return}if(i){E.current={center:y,zoom:b};return}let r=R.current,t=G.current;G.current=y;let n=Math.hypot(.75*Math.abs(l(r.center[0],y[0])),Math.abs(y[1]-r.center[1])),c=s(t)&&s(y);if(!(!c&&(n>2||Math.abs(b-r.zoom)>.35))){c&&(N.current.zoom=0),E.current={center:y,zoom:b};return}let o=a(.65+.04*n,.65,2),u=a(Math.min(r.zoom,b)-o,1.5,4);E.current={center:y,zoom:u};let m=Math.round(a(240+10*n,240,560));F.current=window.setTimeout(()=>{E.current={center:y,zoom:b},F.current=null},m)},[i,y,b]),(0,n.jsx)("div",{className:"visual-map",role:"img","aria-label":"Journey focus: ".concat(r.city,", ").concat(r.country),children:(0,n.jsx)(o.ComposableMap,{width:1e3,height:520,projection:"geoMercator",projectionConfig:{scale:150,center:[0,15]},className:"world-svg",children:(0,n.jsxs)(o.ZoomableGroup,{center:j.center,zoom:j.zoom,minZoom:1,maxZoom:12,children:[(0,n.jsx)(o.Sphere,{fill:"rgba(245, 245, 245, 0.95)",stroke:"rgba(0, 0, 0, 0.08)",strokeWidth:.5}),(0,n.jsx)(o.Graticule,{stroke:"rgba(0, 0, 0, 0.12)",strokeWidth:.5,step:[30,15]}),(0,n.jsx)(o.Geographies,{geography:"https://cdn.jsdelivr.net/npm/world-atlas@2/countries-110m.json",children:e=>{let{geographies:r}=e;return r.map(e=>(0,n.jsx)(o.Geography,{geography:e,fill:"rgba(120, 120, 120, 0.5)",stroke:"rgba(0, 0, 0, 0.35)",strokeWidth:.6,style:{default:{outline:"none"},hover:{outline:"none",fill:"rgba(140, 140, 140, 0.6)"},pressed:{outline:"none"}}},e.rsmKey))}}),!i&&(0,n.jsx)(o.Line,{coordinates:M,fill:"none",className:"route-line"}),t.map((e,t)=>{if("whats-next"===e.id)return null;let c=e.id===r.id,a=p>=0&&t<p;return(0,n.jsx)(o.Marker,{coordinates:[e.lng,e.lat],title:"".concat(e.year,": ").concat(e.city,", ").concat(e.country),children:(0,n.jsx)("circle",{r:c?3.2:2.3,className:"route-dot ".concat(c?"active":""),fill:c?"#1a1a1a":a?"#4a4a4a":"#888",stroke:"#fff",strokeWidth:1,opacity:c?1:a?.9:.75})},e.id)}),!i&&(0,n.jsx)(o.Marker,{coordinates:k,children:(0,n.jsxs)("g",{className:"focus-marker",children:[(0,n.jsx)("circle",{r:4.2,fill:"#fff",stroke:"#1a1a1a",strokeWidth:1.4}),(0,n.jsx)("circle",{r:6.8,fill:"none",stroke:"rgba(0, 0, 0, 0.25)",strokeWidth:1.4,className:"pulse"})]})})]})})})}}}]);